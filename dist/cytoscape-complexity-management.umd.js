!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["cytoscape-complexity-management"]=t()}(this,(function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=Array(t);s<t;s++)a[s]=e[s];return a}function t(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function s(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function a(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?s(Object(o),!0).forEach((function(s){t(e,s,o[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var a,o,i,n,r=[],d=!0,l=!1;try{if(i=(s=s.call(e)).next,0===t){if(Object(s)!==s)return;d=!1}else for(;!(d=(a=i.call(s)).done)&&(r.push(a.value),r.length!==t);d=!0);}catch(e){l=!0,o=e}finally{try{if(!d&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(l)throw o}}return r}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(t,s){if(t){if("string"==typeof t)return e(t,s);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,s):void 0}}class d{#e;#t;#s;#a;#o;#i;nodesMap;edgesMap;metaEdgesMap;edgeToMetaEdgeMap;constructor(e,t){this.#e=e,this.#t=[],this.#s=[],this.#a=null,this.#o=null,this.#i=t,this.nodesMap=new Map,this.edgesMap=new Map,this.metaEdgesMap=new Map,this.edgeToMetaEdgeMap=new Map,this.addRoot()}get owner(){return this.#e}get graphs(){return this.#t}get edges(){return this.#s}get rootGraph(){return this.#a}get siblingGraphManager(){return this.#o}get isVisible(){return this.#i}set owner(e){this.#e=e}set graphs(e){this.#t=e}set edges(e){this.#s=e}set rootGraph(e){if(e.owner!=this)throw"Root not in this graph mgr!";this.#a=e,null==e.parent&&(e.parent=this.owner.newNode("Root node"))}set siblingGraphManager(e){this.#o=e}set isVisible(e){this.#i=e}addRoot(){let e=this.#e.newGraph(this),t=this.#e.newNode(),s=this.addGraph(e,t);return this.#a=s,this.#a}addGraph(e,t){if(null==e)throw"Graph is null!";if(null==t)throw"Parent node is null!";if(this.#t.indexOf(e)>-1)throw"Graph already in this graph mgr!";if(this.#t.push(e),null!=e.parent)throw"Already has a parent!";if(null!=t.child)throw"Already has a child!";return e.parent=t,t.child=e,e}addInterGraphEdge(e,t,s){const a=t.owner,o=s.owner;if(null==a||a.owner!=this)throw"Source not in this graph mgr!";if(null==o||o.owner!=this)throw"Target not in this graph mgr!";if(a==o)return e.isInterGraph=!1,a.addEdge(e,t,s);if(e.isInterGraph=!0,e.source=t,e.target=s,this.#s.indexOf(e)>-1)throw"Edge already in inter-graph edge list!";if(e.owner=this,this.#s.push(e),null==e.source||null==e.target)throw"Edge source and/or target is null!";if(-1!=e.source.edges.indexOf(e)||-1!=e.target.edges.indexOf(e))throw"Edge already in source and/or target incidency list!";return e.source.edges.push(e),e.target.edges.push(e),e}removeGraph(e){if(e.owner!=this)throw"Graph not in this graph mgr";if(e!=this.rootGraph&&(null==e.parent||e.parent.owner.owner!=this))throw"Invalid parent node!";let t=[];t=t.concat(e.edges),t.forEach((t=>{e.removeEdge(t)}));let s=[];s=s.concat(e.nodes),s.forEach((t=>{e.removeNode(t)})),e==this.#a&&(this.#a=null);let a=this.#t.indexOf(e);this.#t.splice(a,1),e.parent.child=null,e.parent=null}removeInterGraphEdge(e){if(null==e)throw"Edge is null!";if(!e.isInterGraph)throw"Not an inter-graph edge!";if(null==e.source||null==e.target)throw"Source and/or target is null!";if(-1==e.source.edges.indexOf(e)||-1==e.target.edges.indexOf(e))throw"Source and/or target doesn't know this edge!";let t=e.source.edges.indexOf(e);if(e.source.edges.splice(t,1),t=e.target.edges.indexOf(e),e.target.edges.splice(t,1),null==e.source.owner||null==e.source.owner.owner)throw"Edge owner graph or owner graph manager is null!";if(-1==e.source.owner.owner.edges.indexOf(e))throw"Not in owner graph manager's edge list!";t=e.source.owner.owner.edges.indexOf(e),e.source.owner.owner.edges.splice(t,1)}getDescendantsInorder(e){let t={edges:new Set,simpleNodes:[],compoundNodes:[]},s=e.child;if(s){s.nodes.forEach((e=>{let s=this.getDescendantsInorder(e);for(var a in s)t[a]=[...t[a]||[],...s[a]];t.edges=new Set(t.edges),e.child?t.compoundNodes.push(e):t.simpleNodes.push(e),e.edges.forEach((e=>t.edges.add(e)))}))}return e.edges.forEach((e=>{t.edges.add(e)})),t}}class l{#n;#e;#r;#s;#d;constructor(e,t){this.#n=e,this.#e=t,this.#r=[],this.#s=[],this.#d=null}get parent(){return this.#n}get owner(){return this.#e}get nodes(){return this.#r}get edges(){return this.#s}get siblingGraph(){return this.#d}set parent(e){this.#n=e}set owner(e){this.#e=e}set nodes(e){this.#r=e}set edges(e){this.#s=e}set siblingGraph(e){this.#d=e}addNode(e){if(null==this.#e)throw"Graph has no graph manager!";if(this.#r.indexOf(e)>-1)throw"Node already in graph!";return e.owner=this,this.#r.push(e),e}addEdge(e,t,s){if(!(this.#r.indexOf(t)>-1&&this.#r.indexOf(s)>-1))throw"Source or target not in graph!";if(t.owner!=s.owner||t.owner!=this)throw"Both owners must be this graph!";return this.#s.forEach((t=>{if(t.ID==e.ID)throw"Edge Already Exist"})),t.owner!=s.owner?null:(e.source=t,e.target=s,e.isInterGraph=!1,e.owner=this,this.#s.push(e),t.edges.push(e),s!=t&&s.edges.push(e),e)}removeNode(e){if(null==e)throw"Node is null!";if(null==e.owner||e.owner!=this)throw"Owner graph is invalid!";if(null==this.owner)throw"Owner graph manager is invalid!";e.edges.slice().forEach((e=>{e.isInterGraph?this.owner.removeInterGraphEdge(e):e.source.owner.removeEdge(e)}));const t=this.#r.indexOf(e);if(-1==t)throw"Node not in owner node list!";return this.nodes.splice(t,1),e}removeEdge(e){if(null==e)throw"Edge is null!";if(null==e.source||null==e.target)throw"Source and/or target is null!";if(null==e.source.owner||null==e.target.owner||e.source.owner!=this||e.target.owner!=this)throw"Source and/or target owner is invalid!";const t=e.source.edges.indexOf(e),s=e.target.edges.indexOf(e);if(!(t>-1&&s>-1))throw"Source and/or target doesn't know this edge!";e.source.edges.splice(t,1),e.target!=e.source&&e.target.edges.splice(s,1);const a=e.source.owner.edges.indexOf(e);if(-1==a)throw"Not in owner's edge list!";return e.source.owner.edges.splice(a,1),e}}class g{#l;#e;#i;#g;#p;constructor(e){this.#l=e,this.#e=null,this.#i=!0,this.#g=!1,this.#p=!1}get ID(){return this.#l}get owner(){if(null==this.#e)throw"Owner graph of a node cannot be null";return this.#e}get isVisible(){return this.#i}get isFiltered(){return this.#g}get isHidden(){return this.#p}set ID(e){this.#l=e}set owner(e){this.#e=e}set isVisible(e){this.#i=e}set isFiltered(e){this.#g=e}set isHidden(e){this.#p=e}}class p extends g{#c;#h;#u;constructor(e,t,s){super(e),this.#c=t,this.#h=s,this.#u=!1}get source(){return this.#c}get target(){return this.#h}get isInterGraph(){return this.#u}set source(e){this.#c=e}set target(e){this.#h=e}set isInterGraph(e){this.#u=e}}class c extends g{#I;#s;#f;constructor(e){super(e),this.#I=null,this.#s=[],this.#f=!1}get child(){return this.#I}get edges(){return this.#s}get isCollapsed(){return this.#f}set child(e){this.#I=e}set edges(e){this.#s=e}set isCollapsed(e){this.#f=e}}class h extends p{#E;constructor(e,t,s){super(E.createUniqueID(),e,t),this.#E=s}get originalEdges(){return this.#E}set originalEdges(e){this.#E=e}}class u{static removedElements={nodeIDListForInvisible:new Set,edgeIDListForInvisible:new Set,metaEdgeIDListForVisible:new Set};static addedElements={nodeIDListForVisible:new Set,edgeIDListForVisible:new Set,metaEdgeIDListForVisible:new Set,edgeIDListToRemove:new Set};static#D(e,t,s){let[a,o,i]=this.traverseDescendants(e,e,t,s);t.removeGraph(e.child),a.forEach((e=>{t.nodesMap.delete(e)})),o.forEach((e=>{let s=t.edgesMap.get(e);t.edgesMap.delete(e);try{E.removeEdgeFromGraph(s)}catch(e){}}));let n=s.nodesMap.get(e.ID);n.isCollapsed=!0,a.forEach((e=>{n=s.nodesMap.get(e),n.isVisible=!1})),o.forEach((e=>{let t=s.edgesMap.get(e);t&&(t.isVisible=!1)})),a.forEach((e=>this.removedElements.nodeIDListForInvisible.add(e))),o.forEach((e=>this.removedElements.edgeIDListForInvisible.add(e))),this.removedElements.metaEdgeIDListForVisible.add(i)}static traverseDescendants(e,t,s,a){let o=[],i=[],n=[];if(e.child){e.child.nodes.forEach((e=>{o.push(e.ID),[...e.edges].forEach((o=>{if(o instanceof h?s.edgesMap.delete(o.ID):i.push(o.ID),o.isInterGraph){let r;if(o.source==e){if(r=this.incidentEdgeIsOutOfScope(a.nodesMap.get(o.target.ID),a.nodesMap.get(t.ID),a),r&&s.metaEdgesMap.has(o.ID)&&1==o.originalEdges.length){r=!1;let e=[...o.originalEdges],d=o.target;i.push(o.ID),s.edgesMap.has(o.ID)&&(s.edgesMap.delete(o.ID),E.removeEdgeFromGraph(o)),s.metaEdgesMap.delete(o.ID),e.forEach((e=>{s.edgeToMetaEdgeMap.delete(e)}));let l=f.addMetaEdge(t.ID,d.ID,e,s,a);n.push({ID:l.ID,sourceID:l.source.ID,targetID:l.target.ID,size:l.originalEdges.length,compound:"T"})}if(r){s.metaEdgesMap.get(o.ID)&&E.removeEdgeFromGraph(o);let e=f.addMetaEdge(t.ID,o.target.ID,[o.ID],s,a);n.push({ID:e.ID,sourceID:e.source.ID,targetID:e.target.ID,size:e.originalEdges.length,compound:"T"})}}else{if(r=this.incidentEdgeIsOutOfScope(a.nodesMap.get(o.source.ID),a.nodesMap.get(t.ID),a),r&&s.metaEdgesMap.has(o.ID)&&1==o.originalEdges.length){r=!1;let e=[...o.originalEdges],d=o.source;i.push(o.ID),s.edgesMap.has(o.ID)&&(s.edgesMap.delete(o.ID),E.removeEdgeFromGraph(o)),s.metaEdgesMap.delete(o.ID),e.forEach((e=>{s.edgeToMetaEdgeMap.delete(e)}));let l=f.addMetaEdge(d.ID,t.ID,e,s,a);n.push({ID:l.ID,sourceID:l.source.ID,targetID:l.target.ID,size:l.originalEdges.length,compound:"T"})}if(r){s.metaEdgesMap.get(o.ID)&&E.removeEdgeFromGraph(o);let e=f.addMetaEdge(o.source.ID,t.ID,[o.ID],s,a);n.push({ID:e.ID,sourceID:e.source.ID,targetID:e.target.ID,size:e.originalEdges.length,compound:"T"})}}}}));let[r,d,l]=this.traverseDescendants(e,t,s,a);o=[...o,...r],i=[...i,...d],n=[...n,...l]}))}return[o,i,n]}static incidentEdgeIsOutOfScope(e,t,s){return e.owner==s.rootGraph||e.owner.parent!=t&&this.incidentEdgeIsOutOfScope(e.owner.parent,t,s)}static#m(e,t,s,a,o=void 0){let i=a.nodesMap.get(e.ID);if(i.isCollapsed){let t=s.addGraph(new l(null,s),e);i.child.siblingGraph=t,t.siblingGraph=i.child,i.isCollapsed=!1}let n=i.child.nodes,r=[...n.filter((e=>!!e.child)),...n.filter((e=>!e.child))],d=[];r.forEach((i=>{if(i.isCollapsed&&t&&!i.isFiltered&&!i.isHidden||!i.isCollapsed&&!i.isFiltered&&!i.isHidden){let n=E.moveNodeToVisible(i,s,a,null==o?e:o);n[0].forEach((e=>{try{this.addedElements.edgeIDListForVisible.add(e)}catch(e){}}));let r=[...this.addedElements.edgeIDListForVisible].filter((e=>s.edgesMap.has(e)));if(this.addedElements.edgeIDListForVisible=new Set(r),n[1].forEach((e=>{try{this.addedElements.edgeIDListToRemove.add(e.ID)}catch(e){}let t=[...this.addedElements.metaEdgeIDListForVisible].filter((t=>t.ID!=e.ID));this.addedElements.metaEdgeIDListForVisible=new Set(t)})),n[2].forEach((e=>{this.addedElements.metaEdgeIDListForVisible.add(e)})),this.addedElements.nodeIDListForVisible.add(i.ID),i.child){let o=s.nodesMap.get(i.ID);this.#m(o,t,s,a,e)}}else if(i.isCollapsed&&!t&&!i.isFiltered&&!i.isHidden){this.addedElements.nodeIDListForVisible.add(i.ID);let t=E.moveNodeToVisible(i,s,a,null==o?e:o);t[0].forEach((e=>{this.addedElements.edgeIDListForVisible.add(e)}));let n=[...this.addedElements.edgeIDListForVisible].filter((e=>s.edgesMap.has(e)));this.addedElements.edgeIDListForVisible=new Set(n),t[1].forEach((e=>{this.addedElements.edgeIDListToRemove.add(e.ID);let t=[...this.addedElements.metaEdgeIDListForVisible].filter((t=>t.ID!=e.ID));this.addedElements.metaEdgeIDListForVisible=new Set(t)})),t[2].forEach((e=>{this.addedElements.metaEdgeIDListForVisible.add(e)})),d.push(i)}})),d.forEach((t=>{s.getDescendantsInorder(t).edges.forEach((o=>{if(s.edgeToMetaEdgeMap.has(o.ID)){let i=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(o.ID),s),n=s.nodesMap.get(i.source.ID),r=s.nodesMap.get(i.target.ID);if(!(u.incidentEdgeIsOutOfScope(a.nodesMap.get(i.source.ID),a.nodesMap.get(e.ID),a)||u.incidentEdgeIsOutOfScope(a.nodesMap.get(i.target.ID),a.nodesMap.get(e.ID),a)||i.source.ID!=t.ID&&i.target.ID!=t.ID)){if(s.edgesMap.set(i.ID,i),n.owner===r.owner){if(null!=n&&null!=r)try{n.owner.addEdge(i,n,r)}catch(e){}}else if(null!=n&&null!=r)try{s.addInterGraphEdge(i,n,r)}catch(e){}this.addedElements.metaEdgeIDListForVisible.add({ID:i.ID,sourceID:i.source.ID,targetID:i.target.ID,size:i.originalEdges.length,compound:"T"})}}}))}))}static getDescendantNodes(e){let t=[];return e.child&&e.child.nodes.forEach((e=>{t.push(e);let s=this.getDescendantNodes(e);t=[...t,...s]})),t}static collapseNodes(e,t,s,a){this.removedElements={nodeIDListForInvisible:new Set,edgeIDListForInvisible:new Set,metaEdgeIDListForVisible:new Set};let o=new Set;if(t){e.forEach((e=>{this.removedElements.metaEdgeIDListForVisible=new Set;let t=s.nodesMap.get(e);if(t.child){this.collapseCompoundDescendantNodes(t,s,a),this.#D(t,s,a);let e=0;this.removedElements.metaEdgeIDListForVisible.forEach((t=>{e!=this.removedElements.metaEdgeIDListForVisible.size-1&&t?.forEach((e=>{s.edgesMap.delete(e.ID)})),e+=1}));let i=[...this.removedElements.metaEdgeIDListForVisible];[...i[i.length-1]].forEach((e=>{let t=s.metaEdgesMap.get(e.ID);o.add({ID:t.ID,sourceID:t.source.ID,targetID:t.target.ID,size:t.originalEdges.length,compound:"T"})}))}}));let t=new Set;o.forEach((e=>{s.edgesMap.has(e.ID)&&t.add(e)})),this.removedElements.metaEdgeIDListForVisible=t}else e.forEach((e=>{let t=s.nodesMap.get(e);if(t.child){this.#D(t,s,a);let e=0,o=[];this.removedElements.metaEdgeIDListForVisible.forEach((t=>{e!=this.removedElements.metaEdgeIDListForVisible.size-1&&o.push(t),e+=1}));let i=[...this.removedElements.metaEdgeIDListForVisible],n=[...i[i.length-1],...o];o=[],this.removedElements.metaEdgeIDListForVisible=new Set,n.forEach((e=>{let t=s.metaEdgesMap.get(e.ID);this.removedElements.metaEdgeIDListForVisible.add({ID:t.ID,sourceID:t.source.ID,targetID:t.target.ID,size:t.originalEdges.length,compound:"T"})}))}}));return this.removedElements}static collapseCompoundDescendantNodes(e,t,s){e.child&&e.child.nodes.forEach((e=>{if(e.child){this.collapseCompoundDescendantNodes(e,t,s),this.#D(e,t,s);let a=0;this.removedElements.metaEdgeIDListForVisible.forEach((e=>{a!=this.removedElements.metaEdgeIDListForVisible.size-1&&e.forEach((e=>{t.edgesMap.delete(e.ID)})),a+=1}));let o=[...this.removedElements.metaEdgeIDListForVisible],i=[...o[o.length-1]];this.removedElements.metaEdgeIDListForVisible=new Set;let n=[];i.forEach((e=>{let s=t.metaEdgesMap.get(e.ID);n.push({ID:s.ID,sourceID:s.source.ID,targetID:s.target.ID,size:s.originalEdges.length,compound:"T"})})),this.removedElements.metaEdgeIDListForVisible.add(n)}}))}static expandNodes(e,t,s,a){return this.addedElements={nodeIDListForVisible:new Set,edgeIDListForVisible:new Set,metaEdgeIDListForVisible:new Set,edgeIDListToRemove:new Set},e.forEach((e=>{let o=s.nodesMap.get(e),i=a.nodesMap.get(e);i.child&&i.isCollapsed&&!i.isFiltered&&!i.isHidden&&this.#m(o,t,s,a)})),this.addedElements}static collapseAllNodes(e,t){let s=[];return e.rootGraph.nodes.forEach((e=>{e.child&&s.push(e.ID)})),{collapsedNodes:s,...this.collapseNodes(s,!0,e,t)}}static expandAllNodes(e,t){let s=this.getTopCollapsedCompoundNodes(t.rootGraph.parent);return{expandedNodes:s,...this.expandNodes(s,!0,e,t)}}static getTopCollapsedCompoundNodes(e){let t=[];return e.child&&e.child.nodes.forEach((e=>{if(e.child&&e.isCollapsed)t.push(e.ID);else if(e.child&&!e.isCollapsed){let s=this.getTopCollapsedCompoundNodes(e);t=[...t,...s]}})),t}static collapseEdges(e,t,s){let a=t.edgesMap.get(e[0]),o=a.source,i=a.target,n=f.addMetaEdge(o.ID,i.ID,e,t,s),r=[];return e.forEach((e=>{let s=t.edgesMap.get(e);s instanceof h||r.push(e),t.edgesMap.has(e)&&(E.removeEdgeFromGraph(s),t.edgesMap.delete(s.ID))})),r.forEach((e=>{s.edgesMap.get(e).isVisible=!1})),[{ID:n.ID,sourceID:n.source.ID,targetID:n.target.ID,size:n.originalEdges.length,compound:"T"}]}static expandEdges(e,t,s,a){let o=[[],[],[]];return e=e.filter((e=>{let t=s.metaEdgesMap.get(e);return!!t&&1!=t.originalEdges.length})),o[2]=[...e],e.forEach((e=>{let i=s.metaEdgesMap.get(e),n=i.source,r=i.target;i.originalEdges.forEach((e=>{if(s.metaEdgesMap.has(e)){let i=s.metaEdgesMap.get(e),n=s.nodesMap.get(i.source.ID),r=s.nodesMap.get(i.target.ID);if(t&&1!=i.originalEdges.length){let e=this.expandEdges([i.ID],t,s,a);s.metaEdgesMap.delete(i.ID),o[0]=[...o[0],...e[0]],o[1]=[...o[1],...e[1]],o[2]=[...o[2],...e[2]]}else n.owner==r.owner?n.owner.addEdge(i,n,r):s.addInterGraphEdge(i,n,r),s.edgesMap.set(i.ID,i),o[1].push({ID:i.ID,sourceID:n.ID,targetID:r.ID,size:i.originalEdges.length,compound:"T"})}else if(a.edgesMap.has(e)){let t=a.edgesMap.get(e);if(0==t.isFiltered&&0==t.isHidden){t.isVisible=!0,n=s.nodesMap.get(t.source.ID),r=s.nodesMap.get(t.target.ID);let a=new p(t.ID,n,r);n.owner==r.owner?n.owner.addEdge(a,n,r):s.addInterGraphEdge(a,n,r),s.edgesMap.set(a.ID,a),o[0].push(e)}}s.edgeToMetaEdgeMap.delete(e)})),s.metaEdgesMap.delete(e),s.edgesMap.has(e)&&(E.removeEdgeFromGraph(i),s.edgesMap.delete(e))})),o}static collapseEdgesBetweenNodes(e,t,s){let a=[[],[]];for(let o=0;o<e.length;o++)for(let i=o+1;i<e.length;i++){let n=t.nodesMap.get(e[o]),r=t.nodesMap.get(e[i]),d=[];if(n.edges.forEach((e=>{e.source.ID!=r.ID&&e.target.ID!=r.ID||d.includes(e.ID)||d.push(e.ID)})),d.length>1){let e=this.collapseEdges(d,t,s);a[0]=[...a[0],...d],a[1]=[...a[1],...e]}}return a}static expandEdgesBetweenNodes(e,t,s,a){let o=[[],[],[]];for(let i=0;i<e.length;i++)for(let n=i+1;n<e.length;n++){let r=s.nodesMap.get(e[i]),d=s.nodesMap.get(e[n]),l=[];if(r.edges.forEach((e=>{e.source.ID!=d.ID&&e.target.ID!=d.ID||s.metaEdgesMap.has(e.ID)&&(l.includes(e.ID)||1==e.originalEdges.length||l.push(e.ID))})),0!=l.length){let e=this.expandEdges(l,t,s,a);o[0]=[...o[0],...e[0]],o[1]=[...o[1],...e[1]],o[2]=[...o[2],...l]}}return o}static collapseAllEdges(e,t){let s=[];return e.nodesMap.forEach(((e,t)=>{s.push(t)})),this.collapseEdgesBetweenNodes(s,e,t)}static expandAllEdges(e,t){let s=[];return e.nodesMap.forEach(((e,t)=>{s.push(t)})),this.expandEdgesBetweenNodes(s,!0,e,t)}}class I{static filter(e,t,s,a){let o=[],i=[];return t.forEach((e=>{let t=s.edgesMap.get(e);if(t)s.edgesMap.has(e)&&(s.edgesMap.delete(t.ID),E.removeEdgeFromGraph(t)),i.push(e);else if(s.edgeToMetaEdgeMap.has(e)){let t=s.edgeToMetaEdgeMap.get(e);this.updateMetaEdge(t.originalEdges,e,s,a)&&(s.edgesMap.has(t.ID)&&(s.edgesMap.delete(t.ID),E.removeEdgeFromGraph(t)),i.push(t.ID))}let o=a.edgesMap.get(e);o&&(o.isFiltered=!0,o.isVisible=!1)})),e.forEach((e=>{let t=s.nodesMap.get(e);if(t){let n=s.getDescendantsInorder(t);n.edges.forEach((e=>{if(i.push(e.ID),!(e instanceof h)){a.edgesMap.get(e.ID).isVisible=!1}s.edgesMap.has(e.ID)&&(s.edgesMap.delete(e.ID),E.removeEdgeFromGraph(e))})),n.simpleNodes.forEach((e=>{a.nodesMap.get(e.ID).isVisible=!1,o.push(e.ID),e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),n.compoundNodes.forEach((e=>{a.nodesMap.get(e.ID).isVisible=!1,o.push(e.ID),0==e.child.nodes.length&&(e.child.siblingGraph.siblingGraph=null),s.removeGraph(e.child),e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),t.child&&0==t.child.nodes.length&&(t.child.siblingGraph.siblingGraph=null),t.child&&s.removeGraph(t.child),t.owner.removeNode(t),s.nodesMap.delete(e),o.push(e);let r=a.nodesMap.get(e);r.isFiltered=!0,r.isVisible=!1}else{let t=a.nodesMap.get(e);a.getDescendantsInorder(t).edges.forEach((e=>{let t=e.ID;if(s.edgeToMetaEdgeMap.has(t)){let e=s.edgeToMetaEdgeMap.get(t);this.updateMetaEdge(e.originalEdges,t,s,a)&&(s.edgesMap.has(e.ID)&&(s.edgesMap.delete(e.ID),E.removeEdgeFromGraph(e)),i.push(e.ID))}})),t.isFiltered=!0,t.isVisible=!1}})),i=new Set(i),i=[...i],i.concat(o)}static unfilter(e,t,s,a){let o=[],i=[],n=[];return e.forEach((e=>{let r=a.nodesMap.get(e);r.isFiltered=!1;let d=!0;if(0==r.isHidden){let e=r;for(;e.owner!=a.rootGraph;){if(e.owner.parent.isHidden||e.owner.parent.isFiltered||e.owner.parent.isCollapsed){d=!1;break}e=e.owner.parent}}else d=!1;if(d){let e=E.moveNodeToVisible(r,s,a);e[0].forEach((e=>{if(s.edgeToMetaEdgeMap.has(e)){let t=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(e),s);i.push(t.ID)}else i.push(e)})),e[2].forEach((e=>{n.push(e)}));let d=[];r.isCollapsed||(d=I.makeDescendantNodesVisible(r,s,a),o=[...o,...d.simpleNodes,...d.compoundNodes],i=[...i,...d.edges]),s.getDescendantsInorder(r).edges.forEach((e=>{if(s.edgeToMetaEdgeMap.has(e.ID)){let a=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(e.ID),s);a.source.ID!=r.ID&&a.target.ID!=r.ID||t.push(e.ID)}})),o.push(r.ID)}else{let e=!0;if(0==r.isHidden){let t=r;for(;t.owner!=a.rootGraph;){if(t.owner.parent.isHidden||t.owner.parent.isFiltered){e=!1;break}t=t.owner.parent}}else e=!1;if(e){let e=[[],[],[]];r.edges.forEach((t=>{if(0==t.isFiltered&&0==t.isHidden)if(t.source.isVisible){let o=E.getVisibleParent(t.target.ID,a);if(o&&u.incidentEdgeIsOutOfScope(t.source,a.nodesMap.get(o),a)){let i=E.recursiveMetaEdgeUpdate(t,s,a);e[1]=[...e[1],...i[0]],e[0]=[...e[0],...i[1]];let n=s.nodesMap.get(o),r=f.addMetaEdge(t.source.ID,n.ID,[t.ID],s,a);e[2].push({ID:r.ID,sourceID:r.source.ID,targetID:r.target.ID,size:r.originalEdges.length,compound:"T"})}}else if(t.target.isVisible){let o=E.getVisibleParent(t.source.ID,a);if(o&&u.incidentEdgeIsOutOfScope(t.target,a.nodesMap.get(o),a)){let i=E.recursiveMetaEdgeUpdate(t,s,a);e[1]=[...e[1],...i[0]],e[0]=[...e[0],...i[1]];let n=s.nodesMap.get(o),r=f.addMetaEdge(n.ID,t.target.ID,[t.ID],s,a);e[2].push({ID:r.ID,sourceID:r.source.ID,targetID:r.target.ID,size:r.originalEdges.length,compound:"T"})}}else{let o=E.getVisibleParent(t.source.ID,a),i=E.getVisibleParent(t.target.ID,a);if(o&&i&&o!=i&&u.incidentEdgeIsOutOfScope(a.nodesMap.get(i),a.nodesMap.get(o),a)&&u.incidentEdgeIsOutOfScope(a.nodesMap.get(o),a.nodesMap.get(i),a)){let n=E.recursiveMetaEdgeUpdate(t,s,a);e[1]=[...e[1],...n[0]],e[0]=[...e[0],...n[1]];let r=s.nodesMap.get(o),d=s.nodesMap.get(i),l=f.addMetaEdge(r.ID,d.ID,[t.ID],s,a);e[2].push({ID:l.ID,sourceID:l.source.ID,targetID:l.target.ID,size:l.originalEdges.length,compound:"T"})}}})),e[0].forEach((e=>{if(s.edgeToMetaEdgeMap.has(e)){let t=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(e),s);i.push(t.ID)}else i.push(e)})),e[2].forEach((e=>{n.push(e)}))}}})),t.forEach((e=>{let t=a.edgesMap.get(e);if(t.isFiltered=!1,s.edgeToMetaEdgeMap.has(e)){let t=s.edgeToMetaEdgeMap.get(e);if(s.edgesMap.has(t.ID));else{let o=s.nodesMap.get(t.source.ID),n=s.nodesMap.get(t.target.ID);if(null!=o&&null!=n){let r=a.edgesMap.get(e);r.source.owner==r.target.owner?r.source.owner.siblingGraph.addEdge(t,o,n):s.addInterGraphEdge(t,o,n),s.edgesMap.set(t.ID,t),i.push(t.ID)}}}else 0==t.isHidden&&t.source.isVisible&&t.target.isVisible&&(E.moveEdgeToVisible(t,s,a),i.push(t.ID))})),i=new Set(i),i=[...i],[o.concat(i),n]}static makeDescendantNodesVisible(e,t,s){let a={edges:new Set,simpleNodes:[],compoundNodes:[]};if(e.child){e.child.nodes.forEach((e=>{if(0==e.isFiltered&&0==e.isHidden){if(E.moveNodeToVisible(e,t,s)[0].forEach((e=>{a.edges.add(e)})),0==e.isCollapsed){let i=this.makeDescendantNodesVisible(e,t,s);for(var o in i)a[o]=[...a[o]||[],...i[o]];a.edges=new Set(a.edges),e.child?a.compoundNodes.push(e.ID):a.simpleNodes.push(e.ID),e.edges.forEach((e=>{if(0==e.isFiltered&&0==e.isHidden&&e.source.isVisible&&e.target.isVisible)if(t.edgeToMetaEdgeMap.has(e.ID)){let s=E.getTopMetaEdge(e,t);a.edges.add(s.ID)}else a.edges.add(e.ID)}))}}}))}return e.edges.forEach((e=>{if(0==e.isFiltered&&0==e.isHidden&&e.source.isVisible&&e.target.isVisible)if(t.edgeToMetaEdgeMap.has(e.ID)){let s=E.getTopMetaEdge(e,t);a.edges.add(s.ID)}else a.edges.add(e.ID)})),a}static updateMetaEdge(e,t,s,a){let o=!0;return e.forEach(((e,i)=>{if(s.metaEdgesMap.has(e)){let i=s.metaEdgesMap.get(e),n=this.updateMetaEdge(i.originalEdges,t,s,a);o=0==n?n:o}else{let s=a.edgesMap.get(e);0==s?.isFiltered&&0==s?.isHidden&&e!=t&&(o=!1)}})),o}}class f{static addNode(e,t,s,a){let o,i;if(t){let e=s.nodesMap.get(t);o=e.child?e.child:s.addGraph(new l(null,s),e)}else o=s.rootGraph;let n=new c(e);o.addNode(n),s.nodesMap.set(e,n);let r=new c(e);if(o.siblingGraph)o.siblingGraph.addNode(r);else{if(t){let e=a.nodesMap.get(t);i=e.child?e.child:a.addGraph(new l(null,a),e)}else i=a.rootGraph;i.addNode(r),o.siblingGraph=i,i.siblingGraph=o}a.nodesMap.set(e,r)}static addEdge(e,t,s,a,o){let i,n=a.nodesMap.get(t),r=a.nodesMap.get(s),d=o.nodesMap.get(t),l=o.nodesMap.get(s);null!=n&&null!=r&&(i=new p(e,n,r));let g=new p(e,d,l);d.owner===l.owner?(null!=n&&null!=r&&n.owner.addEdge(i,n,r),d.owner.addEdge(g,d,l)):(null!=n&&null!=r&&a.addInterGraphEdge(i,n,r),o.addInterGraphEdge(g,d,l)),null!=n&&null!=r&&a.edgesMap.set(e,i),o.edgesMap.set(e,g)}static addMetaEdge(e,t,s,a,o){let i,n=a.nodesMap.get(e),r=a.nodesMap.get(t);return null!=n&&null!=r&&(i=new h(n,r,s),a.metaEdgesMap.set(i.ID,i),s.forEach((e=>{a.edgeToMetaEdgeMap.set(e,i)}))),n.owner===r.owner?null!=n&&null!=r&&n.owner.addEdge(i,n,r):null!=n&&null!=r&&a.addInterGraphEdge(i,n,r),null!=n&&null!=r&&a.edgesMap.set(i.ID,i),i}static removeNestedEdges(e,t,s){e.forEach((e=>{if(t.metaEdgesMap.has(e)){let a=t.metaEdgesMap.get(e);f.removeNestedEdges(a.originalEdges,t,s),t.metaEdgesMap.delete(e)}else{let t=s.edgesMap.get(e);s.edgesMap.delete(t.ID),E.removeEdgeFromGraph(t)}}))}static recursivelyRemoveDescendantEdges(e,t,s){e.forEach((e=>{let a=t.edgesMap.get(e),o=s.edgesMap.get(e);if(t.metaEdgesMap.has(e)){a=t.metaEdgesMap.get(e),t.edgesMap.delete(a.ID),t.metaEdgesMap.delete(a.ID);try{E.removeEdgeFromGraph(a)}catch(e){}t.edgeToMetaEdgeMap.has(a.ID)&&t.edgeToMetaEdgeMap.delete(a.ID),this.recursivelyRemoveDescendantEdges(a.originalEdges,t,s)}else if(t.edgesMap.has(e)){t.edgesMap.delete(a.ID);try{E.removeEdgeFromGraph(a)}catch(e){}s.edgesMap.delete(o.ID);try{E.removeEdgeFromGraph(o)}catch(e){}}else{t.edgeToMetaEdgeMap.has(e)&&t.edgeToMetaEdgeMap.delete(e),s.edgesMap.delete(o.ID);try{E.removeEdgeFromGraph(o)}catch(e){}}}))}static removeEdge(e,t,s){let a=t.edgesMap.get(e),o=s.edgesMap.get(e);a?t.metaEdgesMap.has(e)?(a=E.getTopMetaEdge(a,t),t.edgesMap.delete(a.ID),t.metaEdgesMap.delete(a.ID),E.removeEdgeFromGraph(a),t.edgeToMetaEdgeMap.has(a.ID)&&t.edgeToMetaEdgeMap.delete(a.ID),this.recursivelyRemoveDescendantEdges(a.originalEdges,t,s)):t.edgesMap.has(e)&&(t.edgesMap.delete(a.ID),E.removeEdgeFromGraph(a),s.edgesMap.delete(o.ID),E.removeEdgeFromGraph(o)):(t.edgeToMetaEdgeMap.has(e)&&E.recursiveMetaEdgeUpdate(o,t),s.edgesMap.delete(o.ID),E.removeEdgeFromGraph(o))}static removeNode(e,t,s){let a=t.nodesMap.get(e),o=s.nodesMap.get(e);if(a){let i=t.getDescendantsInorder(a);i.edges.forEach((e=>{f.removeEdge(e.ID,t,s)})),i.simpleNodes.forEach((e=>{e.owner.removeNode(e),t.nodesMap.delete(e.ID)})),i.compoundNodes.forEach((e=>{e.owner.removeNode(e),t.nodesMap.delete(e.ID)}));let n=s.getDescendantsInorder(o);n.edges.forEach((e=>{f.removeEdge(e.ID,t,s)})),n.simpleNodes.forEach((e=>{e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),n.compoundNodes.forEach((e=>{e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),a.owner.removeNode(a),t.nodesMap.delete(e),o.owner.removeNode(o),s.nodesMap.delete(e)}else o&&(o.owner.removeNode(o),s.nodesMap.delete(e));t.graphs.forEach(((e,s)=>{0==e.nodes.length&&e!=t.rootGraph&&t.graphs.splice(s,1)})),s.graphs.forEach(((e,t)=>{0==e.nodes.length&&e!=s.rootGraph&&s.graphs.splice(t,1)}))}static reconnect(e,t,s,a,o){let i=a.edgesMap.get(e);null==t?t=i.source.ID:null==s&&(s=i.target.ID),i&&(a.edgesMap.delete(i.ID),E.removeEdgeFromGraph(i));let n=o.edgesMap.get(e),r=new p(e,t,s);r.isVisible=n.isVisible,r.isHidden=n.isHidden,E.removeEdgeFromGraph(n),0==r.isFiltered&&0==r.isHidden&&a.nodesMap.get(t).isVisible&&a.nodesMap.get(s).isVisible?r.isVisible=!0:r.isVisible=!1,1==r.isVisible?f.addEdge(e,t,s,a,o):r.source.owner==r.target.owner?r.source.owner.addEdge(r,r.source,r.target):o.addInterGraphEdge(r,r.source,r.target)}static changeParent(e,t,s,a){let o=s.nodesMap.get(e),i=[...o.edges];if(o){let e=s.nodesMap.get(t);null==e&&(e=s.rootGraph.parent);let a=o.owner.removeNode(o);null==e.child&&s.addGraph(new l(null,s),e),e.child.addNode(a)}let n=a.nodesMap.get(e),r=a.nodesMap.get(t);null==r&&(r=a.rootGraph.parent);let d=n.owner.removeNode(n);null==r.child&&a.addGraph(new l(null,a),r),r.child.addNode(d),i.forEach((e=>{if(f.addEdge(e.ID,e.source.ID,e.target.ID,s,a),e.source.isVisible&&e.target.isVisible){a.edgesMap.get(e.ID).isVisible=!1}}))}}class E{static lastID=0;static createUniqueID(){let e="Object#"+this.lastID;return this.lastID++,e}static removeEdgeFromGraph(e){e.owner instanceof d?e.owner.removeInterGraphEdge(e):e.owner.removeEdge(e)}static recursiveMetaEdgeUpdate(e,t,s){let a=[[],[]],o=t.edgeToMetaEdgeMap.get(e.ID);if(null==o)return a;if(t.edgeToMetaEdgeMap.delete(e.ID),t.edgeToMetaEdgeMap.has(o.ID)&&1==o.originalEdges.length){let e=this.recursiveMetaEdgeUpdate(o,t,s);a[0]=[...a[0],...e[0]],a[1]=[...a[1],...e[1]]}if(t.metaEdgesMap.has(o.ID)){let s=[...t.metaEdgesMap.get(o.ID)?.originalEdges];if(s=s.filter((t=>t!=e.ID)),0==s.length)t.metaEdgesMap.delete(o.ID),t.edgesMap.has(o.ID)&&(E.removeEdgeFromGraph(o),t.edgesMap.delete(o.ID),a[0].push({ID:o.ID,sourceID:o.source.ID,targetID:o.target.ID}));else if(1==s.length){if(t.edgeToMetaEdgeMap.delete(s[0]),t.edgeToMetaEdgeMap.has(o.ID)){let e=t.edgeToMetaEdgeMap.get(o.ID);e.originalEdges.push(s[0]),t.edgeToMetaEdgeMap.set(s[0],e);let a=e.originalEdges.filter((e=>e!=o.ID));e.originalEdges=a}if(t.metaEdgesMap.delete(o.ID),t.edgesMap.has(o.ID)){try{E.removeEdgeFromGraph(o)}catch(e){}t.edgesMap.delete(o.ID),a[0].push({ID:o.ID,sourceID:o.source.ID,targetID:o.target.ID})}}else t.metaEdgesMap.get(o.ID).originalEdges=s}return a}static getTopMetaEdge(e,t){let s=t.edgeToMetaEdgeMap.get(e.ID);return s?(t.edgeToMetaEdgeMap.has(s.ID)&&(s=this.getTopMetaEdge(s,t)),s):e}static recursiveExpand(e,t,s=!0){let a=t.edgeToMetaEdgeMap.get(e),o=t.edgeToMetaEdgeMap.get(a.ID);if(null!=o){if(1!=o.originalEdges.length)return this.recursiveExpand(a.ID,t);if(t.edgesMap.has(a.ID)||!s)return a;{let e=t.nodesMap.get(a.source.ID),s=t.nodesMap.get(a.target.ID);if(e&&s)return e.owner==s.owner?e.owner.addEdge(a,e,s):t.addInterGraphEdge(a,e,s),t.edgesMap.set(a.ID,a),a}}return["None",a]}static getVisibleParent(e,t){let s=t.nodesMap.get(e);return s?s.isVisible?s.ID:this.getVisibleParent(s.owner.parent.ID,t):void 0}static moveNodeToVisible(e,t,s,a={ID:void 0}){var o=[[],[],[]];let i=[];e.isVisible=!0;let n=new c(e.ID),r=e.owner.siblingGraph.addNode(n);if(t.nodesMap.set(r.ID,r),e.child)if(0==e.isCollapsed){let s=t.addGraph(new l(null,t),n);s.siblingGraph=e.child,e.child.siblingGraph=s}else{t.getDescendantsInorder(e).edges.forEach((e=>{(u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.source.ID),s.nodesMap.get(a.ID),s)||u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.target.ID),s.nodesMap.get(a.ID),s))&&i.push(e)}))}let d=[[],[],[]],g=[];e.edges.forEach((e=>{s.nodesMap.get(e.source.ID).isVisible&&s.nodesMap.get(e.target.ID).isVisible&&i.push(e),(u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.source.ID),s.nodesMap.get(a.ID),s)||u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.target.ID),s.nodesMap.get(a.ID),s))&&i.push(e)}));let p=new Set(i);return i=[...p],i.forEach((e=>{if(t.edgeToMetaEdgeMap.has(e.ID)){let i=t.edgeToMetaEdgeMap.get(e.ID);if(t.edgesMap.has(i.ID)&&1==i.originalEdges.length){t.edgesMap.delete(i.ID),t.metaEdgesMap.delete(i.ID),t.edgeToMetaEdgeMap.delete(e.ID),o[1].push({ID:i.ID,sourceID:i.source.ID,targetID:i.target.ID});try{E.removeEdgeFromGraph(i)}catch(e){}if(0==e.isFiltered&&0==e.isHidden)if(e.source.isVisible&&e.target.isVisible)E.moveEdgeToVisible(e,t,s),o[0].push(e.ID);else if(e.source.isVisible){let a=this.getVisibleParent(e.target.ID,s);if(a){let i=t.nodesMap.get(a),n=f.addMetaEdge(e.source.ID,i.ID,[e.ID],t,s);o[2].push({ID:n.ID,sourceID:n.source.ID,targetID:n.target.ID,size:n.originalEdges.length,compound:"T"})}}else if(e.target.isVisible){let a=this.getVisibleParent(e.source.ID,s);if(a){let i=t.nodesMap.get(a),n=f.addMetaEdge(i.ID,e.target.ID,[e.ID],t,s);o[2].push({ID:n.ID,sourceID:n.source.ID,targetID:n.target.ID,size:n.originalEdges.length,compound:"T"})}}else{let a=this.getVisibleParent(e.source.ID,s),i=this.getVisibleParent(e.target.ID,s);if(a&&i){let n=t.nodesMap.get(a),r=t.nodesMap.get(i),d=f.addMetaEdge(n.ID,r.ID,[e.ID],t,s);o[2].push({ID:d.ID,sourceID:d.source.ID,targetID:d.target.ID,size:d.originalEdges.length,compound:"T"})}}}else if(t.edgesMap.has(i.ID)&&1!=i.originalEdges.length);else if(1==i.originalEdges.length){if(0==e.isFiltered&&0==e.isHidden)if(e.source.isVisible&&e.target.isVisible){E.moveEdgeToVisible(e,t,s),o[0].push(e.ID);let a=this.recursiveMetaEdgeUpdate(e,t,s);o[1]=[...o[1],...a[0]],o[0]=[...o[0],...a[1]]}else if(e.source.isVisible){let a=this.getVisibleParent(e.target.ID,s);if(a&&u.incidentEdgeIsOutOfScope(e.source,s.nodesMap.get(a),s)){let i=this.recursiveMetaEdgeUpdate(e,t,s);o[1]=[...o[1],...i[0]],o[0]=[...o[0],...i[1]];let n=t.nodesMap.get(a),r=f.addMetaEdge(e.source.ID,n.ID,[e.ID],t,s);o[2].push({ID:r.ID,sourceID:r.source.ID,targetID:r.target.ID,size:r.originalEdges.length,compound:"T"})}}else if(e.target.isVisible){let a=this.getVisibleParent(e.source.ID,s);if(a&&u.incidentEdgeIsOutOfScope(e.target,s.nodesMap.get(a),s)){let i=this.recursiveMetaEdgeUpdate(e,t,s);o[1]=[...o[1],...i[0]],o[0]=[...o[0],...i[1]];let n=t.nodesMap.get(a),r=f.addMetaEdge(n.ID,e.target.ID,[e.ID],t,s);o[2].push({ID:r.ID,sourceID:r.source.ID,targetID:r.target.ID,size:r.originalEdges.length,compound:"T"})}}else{let a=this.getVisibleParent(e.source.ID,s),i=this.getVisibleParent(e.target.ID,s);if(a&&i&&a!=i&&u.incidentEdgeIsOutOfScope(s.nodesMap.get(i),s.nodesMap.get(a),s)&&u.incidentEdgeIsOutOfScope(s.nodesMap.get(a),s.nodesMap.get(i),s)){let n=this.recursiveMetaEdgeUpdate(e,t,s);o[1]=[...o[1],...n[0]],o[0]=[...o[0],...n[1]];let r=t.nodesMap.get(a),d=t.nodesMap.get(i),l=f.addMetaEdge(r.ID,d.ID,[e.ID],t,s);o[2].push({ID:l.ID,sourceID:l.source.ID,targetID:l.target.ID,size:l.originalEdges.length,compound:"T"})}}}else if(i=this.getTopMetaEdge(i,t),1==i.originalEdges.length){let s=this.recursiveExpand(e.ID,t);Array.isArray(s)?(d[1].includes(i)||d[1].push(i),d[2].includes(s[1])||d[2].push(s[1])):(d[1].includes(i)||d[1].push(i),o[0].push(s.ID))}else{let n=this.recursiveExpand(e.ID,t,!1);if(!Array.isArray(n)){o[0].push(i.ID);let e=this.recursiveMetaEdgeUpdate(n,t,s);o[1]=[...o[1],...e[0]],o[0]=[...o[0],...e[1]],i=n}let r=t.nodesMap.get(i.source.ID),d=t.nodesMap.get(i.target.ID);if(r&&d){if(e.source.owner==e.target.owner){if(!I.updateMetaEdge(i.originalEdges,null,t,s))try{e.source.owner.siblingGraph.addEdge(i,r,d);g.push(i)}catch(e){}}else if(!I.updateMetaEdge(i.originalEdges,null,t,s))try{t.addInterGraphEdge(i,r,d);g.push(i)}catch(e){}I.updateMetaEdge(i.originalEdges,null,t,s)||(t.edgesMap.set(i.ID,i),o[0].push(i.ID))}else if(u.incidentEdgeIsOutOfScope(s.nodesMap.get(i.source.ID).isVisible?s.nodesMap.get(i.target.ID):s.nodesMap.get(i.source.ID),s.nodesMap.get(a.ID),s))if(r){let a=this.getVisibleParent(i.target.ID,s);if(a&&u.incidentEdgeIsOutOfScope(e.source.isVisible?e.target:e.source,s.nodesMap.get(a),s)){let e=t.nodesMap.get(a),n=f.addMetaEdge(i.source.ID,e.ID,[i.ID],t,s);o[2].push({ID:n.ID,sourceID:n.source.ID,targetID:n.target.ID,size:n.originalEdges.length,compound:"T"})}}else{let a=this.getVisibleParent(i.source.ID,s);if(a&&u.incidentEdgeIsOutOfScope(e.source.isVisible?e.target:e.source,s.nodesMap.get(a),s)){let e=t.nodesMap.get(a),n=f.addMetaEdge(e.ID,i.target.ID,[i.ID],t,s);o[2].push({ID:n.ID,sourceID:n.source.ID,targetID:n.target.ID,size:n.originalEdges.length,compound:"T"})}}}}else 0==e.isFiltered&&0==e.isHidden&&e.source.isVisible&&e.target.isVisible&&(E.moveEdgeToVisible(e,t,s),o[0].push(e.ID))})),0==d[0].length&&0==d[1].length||(d[1].forEach((e=>{t.edgesMap.delete(e.ID),t.metaEdgesMap.delete(e.ID),o[1].push({ID:e.ID,sourceID:e.source.ID,targetID:e.target.ID});try{E.removeEdgeFromGraph(e)}catch(e){}})),d[2].forEach((e=>{if(t.nodesMap.has(e.source.ID)){let a=this.getVisibleParent(e.target.ID,s);if(a){let i=t.nodesMap.get(a);if(u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.source.ID),s.nodesMap.get(a),s)){let a=f.addMetaEdge(e.source.ID,i.ID,[e.ID],t,s);o[2].push({ID:a.ID,sourceID:a.source.ID,targetID:a.target.ID,size:a.originalEdges.length,compound:"T"})}}}else if(e.target.isVisible){let a=this.getVisibleParent(e.source.ID,s);if(a){let i=t.nodesMap.get(a);if(u.incidentEdgeIsOutOfScope(s.nodesMap.get(e.target.ID),s.nodesMap.get(a),s)){let a=f.addMetaEdge(i.ID,e.target.ID,[e.ID],t,s);o[2].push({ID:a.ID,sourceID:a.source.ID,targetID:a.target.ID,size:a.originalEdges.length,compound:"T"})}}}else{let a=this.getVisibleParent(e.source.ID,s),i=this.getVisibleParent(e.target.ID,s);if(a&&i&&a!=i){let n=t.nodesMap.get(a),r=t.nodesMap.get(i);if(u.incidentEdgeIsOutOfScope(s.nodesMap.get(a),s.nodesMap.get(i),s)&&u.incidentEdgeIsOutOfScope(s.nodesMap.get(i),s.nodesMap.get(a),s)){let a=f.addMetaEdge(n.ID,r.ID,[e.ID],t,s);o[2].push({ID:a.ID,sourceID:a.source.ID,targetID:a.target.ID,size:a.originalEdges.length,compound:"T"})}}}}))),o}static moveEdgeToVisible(e,t,s){e.isVisible=!0;let a,o=new p(e.ID,null,null),i=t.nodesMap.get(e.source.ID),n=t.nodesMap.get(e.target.ID);if(e.source.owner==e.target.owner)try{a=e.source.owner.siblingGraph.addEdge(o,i,n),t.edgesMap.set(a.ID,a)}catch(e){}else a=t.addInterGraphEdge(o,i,n),t.edgesMap.set(a.ID,a)}static getTargetNeighborhoodElements(e,t){let s=t.nodesMap.get(e),a=this.getZeroDistanceNeighbors(s,t);a.nodes.includes(e)||a.nodes.push(e);let o={nodes:[],edges:[]};return a.nodes.forEach((e=>{let s=t.nodesMap.get(e);s.edges.forEach((e=>{e.source.ID==s.ID?o.nodes.push(e.target.ID):o.nodes.push(e.source.ID),o.edges.push(e.ID)}))})),o.nodes=[...new Set([...o.nodes])],o.edges=[...new Set([...o.edges])],o.nodes.forEach((e=>{let s=t.nodesMap.get(e),o=this.getZeroDistanceNeighbors(s,t);a.nodes=[...new Set([...a.nodes,...o.nodes])],a.edges=[...new Set([...a.edges,...o.edges])]})),a.nodes=[...new Set([...a.nodes,...o.nodes])],a.edges=[...new Set([...a.edges,...o.edges])],a.nodes=a.nodes.filter((e=>!t.nodesMap.get(e).isVisible)),a.edges=a.edges.filter((e=>!t.edgesMap.get(e).isVisible)),a}static getZeroDistanceNeighbors(e,t){let s={nodes:[],edges:[]},a=this.getDescendantNeighbors(e),o=this.getPredecessorNeighbors(e,t);return s.nodes=[...new Set([...a.nodes,...o.nodes])],s.edges=[...new Set([...a.edges,...o.edges])],s}static getDescendantNeighbors(e){let t={nodes:[],edges:[]};if(e.child){e.child.nodes.forEach((e=>{t.nodes.push(e.ID),e.edges.forEach((e=>{t.edges.push(e.ID)}));let s=this.getDescendantNeighbors(e);t.nodes=[...t.nodes,...s.nodes],t.edges=[...t.edges,...s.edges]}))}return t}static getPredecessorNeighbors(e,t){let s={nodes:[],edges:[]};if(e.owner!=t.rootGraph){e.owner.nodes.forEach((e=>{s.nodes.push(e.ID),e.edges.forEach((e=>{s.edges.push(e.ID)}))}));let a=this.getPredecessorNeighbors(e.owner.parent,t);s.nodes=[...s.nodes,...a.nodes],s.edges=[...s.edges,...a.edges]}else s.nodes.push(e.ID);return s}}class D{static hide(e,t,s,a){let o=[],i=[];return t.forEach((e=>{let t=s.edgesMap.get(e);if(t)s.edgesMap.has(e)&&(s.edgesMap.delete(t.ID),E.removeEdgeFromGraph(t)),i.push(e);else if(s.edgeToMetaEdgeMap.has(e)){let t=s.edgeToMetaEdgeMap.get(e);this.updateMetaEdge(t.originalEdges,e,s,a)&&(s.edgesMap.has(t.ID)&&(s.edgesMap.delete(t.ID),E.removeEdgeFromGraph(t)),i.push(t.ID))}let o=a.edgesMap.get(e);o&&(o.isHidden=!0,o.isVisible=!1)})),e.forEach((e=>{let t=s.nodesMap.get(e);if(t){let n=s.getDescendantsInorder(t);n.edges.forEach((e=>{if(i.push(e.ID),!(e instanceof h)){a.edgesMap.get(e.ID).isVisible=!1}s.edgesMap.has(e.ID)&&(s.edgesMap.delete(e.ID),E.removeEdgeFromGraph(e))})),n.simpleNodes.forEach((e=>{a.nodesMap.get(e.ID).isVisible=!1,o.push(e.ID),e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),n.compoundNodes.forEach((e=>{a.nodesMap.get(e.ID).isVisible=!1,o.push(e.ID),0==e.child.nodes.length&&(e.child.siblingGraph.siblingGraph=null),s.removeGraph(e.child),e.owner.removeNode(e),s.nodesMap.delete(e.ID)})),t.child&&0==t.child.nodes.length&&(t.child.siblingGraph.siblingGraph=null),t.child&&s.removeGraph(t.child),t.owner.removeNode(t),s.nodesMap.delete(e),o.push(e);let r=a.nodesMap.get(e);r.isHidden=!0,r.isVisible=!1}else{let t=a.nodesMap.get(e);t.isHidden=!0,t.isVisible=!1}})),i=new Set(i),i=[...i],i.concat(o)}static show(e,t,s,a){let o=[],i=[],n=[];return e.forEach((e=>{let r=a.nodesMap.get(e);r.isHidden=!1;let d=!0;if(0==r.isFiltered){let e=r;for(;e.owner!=a.rootGraph;){if(e.owner.parent.isHidden||e.owner.parent.isFiltered||e.owner.parent.isCollapsed){d=!1;break}e=e.owner.parent}}else d=!1;if(d){let e=E.moveNodeToVisible(r,s,a);e[0].forEach((e=>{if(s.edgeToMetaEdgeMap.has(e)){let t=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(e),s);i.push(t.ID)}else i.push(e)})),e[2].forEach((e=>{n.push(e)}));let d=[];r.isCollapsed||(d=I.makeDescendantNodesVisible(r,s,a),o=[...o,...d.simpleNodes,...d.compoundNodes],i=[...i,...d.edges]),s.getDescendantsInorder(r).edges.forEach((e=>{if(s.edgeToMetaEdgeMap.has(e.ID)){let a=E.getTopMetaEdge(s.edgeToMetaEdgeMap.get(e.ID),s);a.source.ID!=r.ID&&a.target.ID!=r.ID||t.push(e.ID)}})),o.push(r.ID)}})),t.forEach((e=>{let t=a.edgesMap.get(e);if(t.isHidden=!1,s.edgeToMetaEdgeMap.has(e)){let t=s.edgeToMetaEdgeMap.get(e);if(s.edgesMap.has(t.ID));else{let o=s.nodesMap.get(t.source.ID),n=s.nodesMap.get(t.target.ID);if(null!=o&&null!=n){let r=a.edgesMap.get(e);r.source.owner==r.target.owner?r.source.owner.siblingGraph.addEdge(t,o,n):s.addInterGraphEdge(t,o,n),s.edgesMap.set(t.ID,t),i.push(t.ID)}}}else 0==t.isHidden&&t.source.isVisible&&t.target.isVisible&&(E.moveEdgeToVisible(t,s,a),i.push(t.ID))})),i=new Set(i),i=[...i],[o.concat(i),n]}static showAll(e,t){let s=[],a=[];return t.nodesMap.forEach(((e,t)=>{e.isHidden&&s.push(e.ID)})),t.edgesMap.forEach(((e,t)=>{e.isHidden&&a.push(e.ID)})),this.show(s,a,e,t)}}class m{#M;#v;constructor(){this.#M=this.#b(!0),this.#v=this.#b(!1),this.#M.siblingGraphManager=this.#v,this.#v.siblingGraphManager=this.#M}get visibleGraphManager(){return this.#M}get mainGraphManager(){return this.#v}#b(e){return new d(this,e)}newGraph(e){return new l(null,e)}newNode(e){let t=e||E.createUniqueID();return new c(t)}addNode(e,t){let s=this.#M,a=this.#v;f.addNode(e,t,s,a)}addEdge(e,t,s){let a=this.#M,o=this.#v;f.addEdge(e,t,s,a,o)}removeNode(e){let t=this.#M,s=this.#v;f.removeNode(e,t,s)}removeEdge(e){let t=this.#M,s=this.#v;f.removeEdge(e,t,s)}reconnect(e,t,s){let a=this.#M,o=this.#v;f.reconnect(e,t,s,a,o)}changeParent(e,t){let s=this.#M,a=this.#v;f.changeParent(e,t,s,a)}filter(e,t){let s=this.#M,a=this.#v;return I.filter(e,t,s,a)}unfilter(e,t){let s=this.#M,a=this.#v;return I.unfilter(e,t,s,a)}hide(e,t){let s=this.#M,a=this.#v;return D.hide(e,t,s,a)}show(e,t){let s=this.#M,a=this.#v;return D.show(e,t,s,a)}showAll(){let e=this.#M,t=this.#v;return D.showAll(e,t)}collapseNodes(e,t){let s=this.#M,a=this.#v;return u.collapseNodes(e,t,s,a)}expandNodes(e,t){let s=this.#M,a=this.#v;return u.expandNodes(e,t,s,a)}collapseAllNodes(){let e=this.#M,t=this.#v;return u.collapseAllNodes(e,t)}expandAllNodes(){let e=this.#M,t=this.#v;return u.expandAllNodes(e,t)}collapseEdges(e){let t=this.#M,s=this.#v;return t.edgesMap.has(e[0])||e.shift(),u.collapseEdges(e,t,s)}expandEdges(e,t){let s=this.#M,a=this.#v;return u.expandEdges(e,t,s,a)}collapseEdgesBetweenNodes(e){let t=this.#M,s=this.#v;return u.collapseEdgesBetweenNodes(e,t,s)}expandEdgesBetweenNodes(e,t){let s=this.#M,a=this.#v;return u.expandEdgesBetweenNodes(e,t,s,a)}collapseAllEdges(){let e=this.#M,t=this.#v;return u.collapseAllEdges(e,t)}expandAllEdges(){let e=this.#M,t=this.#v;return u.expandAllEdges(e,t)}getHiddenNeighbors(e){let t=this.#v;return E.getTargetNeighborhoodElements(e,t)}isCollapsible(e){let t=this.#v.nodesMap.get(e);return!(!t.child||0!=t.isCollapsed)}isExpandable(e){let t=this.#v.nodesMap.get(e);return!(!t.child||!t.isCollapsed)}}function M(e){var t=function(e,s){for(var a=e.length,o=0;o<a;o++){var i=e[o],n=i.children();s.addNode(i.id(),i.parent().id()),null!=n&&n.length>0&&t(n,s)}},s=new m,n=e.nodes(),r=e.edges();t(function(e){var t={};return e.forEach((function(e){t[e.id()]=!0})),e.filter((function(e,s){"number"==typeof e&&(e=s);for(var a=e.parent()[0];null!=a;){if(t[a.id()])return!1;a=a.parent()[0]}return!0}))}(n),s),function(e,t){for(var s=0;s<e.length;s++){var a=e[s];t.addEdge(a.id(),a.source().id(),a.target().id())}}(r,s);var d=[],l=function(){d.forEach((function(e){if(s.visibleGraphManager.nodesMap.get(e.parent().id())){e.isNode()&&s.addNode(e.id(),e.parent().id());var t=d.indexOf(e);t>-1&&d.splice(t,1),M()}}))},g=function(e){var t=e.target;t.parent().id()?s.visibleGraphManager.nodesMap.get(t.parent().id())?(t.isNode()&&s.addNode(t.id(),t.parent().id()),M()):d.push(t):(t.isNode()?s.addNode(t.id(),t.parent().id()):(l(),s.addEdge(t.id(),t.source().id(),t.target().id())),M());l()},p=function(e){var t=e.target;t.isNode()?s.removeNode(t.id()):s.removeEdge(t.id()),M()};e.on("add",g),e.on("remove",p),e.on("move","edge",(function(e){var t=e.target;s.reconnect(t.id(),t.source().id(),t.target().id()),M()})),e.on("move","node",(function(e){var t=e.target;s.changeParent(t.id(),t.parent().id()),M()}));var c=new Set,h=function(){return e.scratch("cyComplexityManagement").options.filterRule},u=function(e,t){return new Set(i(e).filter((function(e){return!t.has(e)})))};function I(e,t){var s=t.collection();e.forEach((function(e){s.merge(t.getElementById(e))})),t.off("remove",p),t.remove(s).forEach((function(e){t.scratch("cyComplexityManagement").removedEles.set(e.id(),e)})),t.on("remove",p)}function f(e,t){return t.getElementById(e.data().parent).data()?t.getElementById(e.data().parent):e.parent().id()?f(e.parent(),t):void 0}function E(e,t){var s=t.collection(),a=t.collection();e.forEach((function(e){var o=t.scratch("cyComplexityManagement").removedEles.get(e);o&&(o.isNode()?s.merge(o):a.merge(o))})),t.off("add",g),s.forEach((function(e){var s,a,o,i,n,r,d=cyInvisible.getElementById(e.id());if(d.id()){var l=cyInvisible.getElementById(d.data().parent),g=f(d,t);if(g&&(g.id()!=l.id()&&(l=cyInvisible.getElementById(g.id())),g.position()&&e.isChildless())){var p=(s=d.position().x,a=d.position().y,o=l.position().x,i=l.position().y,n=g.position().x,r=g.position().y,{x:s+(n-o),y:a+(r-i)});e.position(p)}}})),t.add(s.merge(a)).forEach((function(e){t.scratch("cyComplexityManagement").removedEles.delete(e.id())})),t.on("add",g)}function D(e,t){t.off("add",g),e.forEach((function(e){try{t.add({group:"edges",data:{id:e.ID,source:e.sourceID,target:e.targetID,size:e.size,compound:e.compound}})}catch(e){}})),t.on("add",g)}function M(){var t=h(),a=new Set;e.elements().forEach((function(e){t(e)&&a.add(e.id())})),e.scratch("cyComplexityManagement").removedEles.forEach((function(e){t(e)&&a.add(e.id())}));var i=u(c,a);i.forEach((function(e){c.delete(e)}));var n=u(a,c);n.forEach((function(e){c.add(e)}));var r=[],d=[],l=[],g=[];n.forEach((function(t){e.getElementById(t).length>0&&e.getElementById(t).isNode()||e.scratch("cyComplexityManagement").removedEles.has(t)&&e.scratch("cyComplexityManagement").removedEles.get(t).isNode()?r.push(t):d.push(t)})),i.forEach((function(t){var s;null!==(s=e.scratch("cyComplexityManagement").removedEles.get(t))&&void 0!==s&&s.isNode()?l.push(t):g.push(t)}));var p=s.filter(r,d),f=o(s.unfilter(l,g),2),m=f[0],M=f[1];I(p,e),E(m,e),D(M,e)}var v={getCompMgrInstance:function(){return s},updateFilterRule:function(t){e.scratch("cyComplexityManagement").options.filterRule=t,M()},getHiddenNeighbors:function(t){var a=e.collection();return t.forEach((function(t){var o=s.getHiddenNeighbors(t.id());o.nodes.forEach((function(t){a.merge(e.scratch("cyComplexityManagement").removedEles.get(t))})),o.edges.forEach((function(t){a.merge(e.scratch("cyComplexityManagement").removedEles.get(t))}))})),a},hide:function(t){var a=[],o=[];t.forEach((function(e){e.isNode()?a.push(e.id()):o.push(e.id())})),I(s.hide(a,o),e)},show:function(t){var a=[],i=[];t.forEach((function(e){e.isNode()?a.push(e.id()):i.push(e.id())}));var n=o(s.show(a,i),2),r=n[0],d=n[1];E(r,e),D(d,e)},showAll:function(){var t=o(s.showAll(),2),a=t[0],i=t[1];E(a,e),D(i,e)},collapseNodes:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[];t.forEach((function(e){s.isCollapsible(e.id())&&(o.push(e.id()),e.data("position-before-collapse",{x:e.position().x,y:e.position().y}),e.data("size-before-collapse",{w:e.outerWidth(),h:e.outerHeight()}),e.addClass("cy-expand-collapse-collapsed-node"))}));var i=s.collapseNodes(o,a),n=[],r=[];i.nodeIDListForInvisible.forEach((function(e){n.push(e)})),i.edgeIDListForInvisible.forEach((function(e){n.push(e)})),i.metaEdgeIDListForVisible.forEach((function(e){r.push(e)})),I(n,e),D(r,e)},expandNodes:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=[];t.forEach((function(t){s.isExpandable(t.id())&&(n.push(t.id()),o&&b(t.data().id,e),t.removeClass("cy-expand-collapse-collapsed-node"),t.removeData("position-before-collapse"),t.removeData("size-before-collapse"))})),setTimeout((function(){var t=s.expandNodes(n,a);E(i(t.nodeIDListForVisible),e),t.nodeIDListForVisible.forEach((function(t){var a=e.getElementById(t);s.isCollapsible(a.id())?(a.removeClass("cy-expand-collapse-collapsed-node"),a.removeData("position-before-collapse"),a.removeData("size-before-collapse")):s.isExpandable(a.id())&&(a.data("position-before-collapse",{x:a.position().x,y:a.position().y}),a.data("size-before-collapse",{w:a.outerWidth(),h:a.outerHeight()}),a.addClass("cy-expand-collapse-collapsed-node"))})),E(i(t.edgeIDListForVisible),e),I(i(t.edgeIDListToRemove),e),D(i(t.metaEdgeIDListForVisible),e)}),o?600:0)},collapseAllNodes:function(){var t=s.collapseAllNodes(),a=[],o=[];t.nodeIDListForInvisible.forEach((function(e){a.push(e)})),t.collapsedNodes.forEach((function(t){var s=e.getElementById(t);s.data("position-before-collapse",{x:s.position().x,y:s.position().y}),s.data("size-before-collapse",{w:s.outerWidth(),h:s.outerHeight()}),s.addClass("cy-expand-collapse-collapsed-node")})),t.edgeIDListForInvisible.forEach((function(e){a.push(e)})),t.metaEdgeIDListForVisible.forEach((function(e){o.push(e)})),I(a,e),D(o,e)},expandAllNodes:function(){var t=s.expandAllNodes();E(i(t.nodeIDListForVisible),e),t.expandedNodes.forEach((function(t){var s=e.getElementById(t);s.removeClass("cy-expand-collapse-collapsed-node"),s.removeData("position-before-collapse"),s.removeData("size-before-collapse")})),E(i(t.edgeIDListForVisible),e);var a=[];e.edges('[compound = "T"]').forEach((function(e){s.visibleGraphManager.edgesMap.has(e.data().id)||a.push(e.data().id)})),I([].concat(i(t.edgeIDListToRemove),a),e)},collapseEdges:function(t){var a=new Map;t.forEach((function(e){var t=[e.source().id(),e.target().id()].sort().join("-");a.has(t)?a.get(t).push(e.id()):a.set(t,[e.id()])})),Array.from(a.values()).forEach((function(t){if(t.length>1){var a=s.collapseEdges(t);I(t,e),D(a,e)}}))},collapseEdgesBetweenNodes:function(t){var a=[];t.forEach((function(e){a.push(e.id())}));var o=s.collapseEdgesBetweenNodes(a);I(o[0],e),D(o[1],e)},collapseAllEdges:function(){var t=s.collapseAllEdges();I(t[0],e),D(t[1],e)},expandEdges:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[];t.forEach((function(e){o.push(e.id())}));var i=s.expandEdges(o,a);I(i[2],e),E(i[0],e),D(i[1],e)},expandEdgesBetweenNodes:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[];t.forEach((function(e){o.push(e.id())}));var i=s.expandEdgesBetweenNodes(o,a);I(i[2],e),E(i[0],e),D(i[1],e)},expandAllEdges:function(){var t=s.expandAllEdges();I(t[2],e),E(t[0],e),D(t[1],e)},isCollapsible:function(e){return s.isCollapsible(e.id())},isExpandable:function(e){return s.isExpandable(e.id())}},b=function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=y(s.mainGraphManager.nodesMap.get(e));cyLayout.remove(cyLayout.elements()),cyLayout.add({group:"nodes",data:{id:e,parent:null,label:o?e:""},position:cyInvisible.getElementById(e).position()}).style({"background-color":"#CCE1F9"});var r=[];n.compoundNodes.forEach((function(e){0!=cyLayout.getElementById(e.owner.parent.ID).length?cyLayout.add({group:"nodes",data:{id:e.ID,parent:e.owner.parent.ID,label:o?e.ID:""},position:cyInvisible.getElementById(e.ID).position()}):r.push({group:"nodes",data:{id:e.ID,parent:e.owner.parent.ID,label:o?e.ID:""},position:cyInvisible.getElementById(e.ID).position()})})),r.forEach((function(e){cyLayout.add(e)})),n.simpleNodes.forEach((function(e){try{cyLayout.add({group:"nodes",data:{id:e.ID,parent:e.owner.parent.ID,label:o?e.ID:""},position:cyInvisible.getElementById(e.ID).position()})}catch(e){console.log(e)}})),i(n.edges).forEach((function(e){try{0==cyLayout.getElementById(e.source.ID).length?cyLayout.add({group:"nodes",data:{id:e.source.ID,label:o?e.source.ID:""},position:cyInvisible.getElementById(e.source.ID).position()}):0==cyLayout.getElementById(e.target.ID).length&&cyLayout.add({group:"nodes",data:{id:e.target.ID,label:o?e.target.ID:""},position:cyInvisible.getElementById(e.target.ID).position()}),cyLayout.add({group:"edges",data:{id:e.ID,source:e.source.ID,target:e.target.ID}})}catch(e){}})),cyLayout.layout({name:"fcose",randomize:!1,animate:!1}).run();var d=cyLayout.getElementById(e).boundingBox(),l=d.w,g=d.h;cyLayout.nodes().forEach((function(e){e.style("label",e.id())})),cyLayout.remove(cyLayout.elements());var p=x(t.getElementById(e));t.nodes().unselect();var c=[];if(t.nodes().forEach((function(e){if(e.id()!=p.id()&&0==e.parent().length){e.isChildless()?e.select():w(e);var s=t.collection(t.$(":selected")).boundingBox(),i=(s=a(a({},s),{},{w:e.width(),h:e.height()})).w,n=s.h;c.push({id:e.id(),data:t.$(":selected"),pos:{x:(s.x2+s.x1)/2,y:(s.y1+s.y2)/2}});var r=cyLayout.add({group:"nodes",data:{id:e.id(),label:e.id()}});r.position({x:(s.x2+s.x1)/2,y:(s.y1+s.y2)/2}),r.style({width:Math.max(i,n),height:Math.max(i,n),label:o?r.data().id:""}),t.nodes().unselect()}})),0==t.getElementById(e).parent().length){var h=cyLayout.add(t.getElementById(e).clone());h.unselect(),h.position({x:t.getElementById(e).position().x,y:t.getElementById(e).position().y}),h.style({width:Math.max(l,g)+"px",height:Math.max(l,g)+"px","background-color":"#CCE1F9",label:o?h.data().id:""})}else{var u=cyLayout.add({group:"nodes",data:{id:p.id(),label:p.id()}});u.position({x:p.position().x,y:p.position().y}),u.style({label:o?u.data().id:""}),w(p);var I=t.$(":selected");t.nodes().unselect(),cyLayout.add(I),I.forEach((function(s){s.select();var i=t.collection(t.$(":selected")).boundingBox(),n=(i=a(a({},i),{},{w:s.width(),h:s.height()})).w,r=i.h;if(s.id()!=e)s.isChildless()&&(c.push({id:s.id(),data:t.$(":selected"),pos:{x:(i.x2+i.x1)/2,y:(i.y1+i.y2)/2}}),(u=cyLayout.getElementById(s.id())).position({x:(i.x2+i.x1)/2,y:(i.y1+i.y2)/2}),u.style({width:Math.max(n,r)+"px",height:Math.max(n,r)+"px",label:o?u.data().id:""}));else{var d=cyLayout.getElementById(s.id());d.position({x:s.position().x,y:s.position().y}),d.style({width:Math.max(l,g)+"px",height:Math.max(l,g)+"px","background-color":"#CCE1F9",label:o?d.data().id:""})}t.nodes().unselect()}))}t.fit(),cyLayout.layout({name:"fcose",quality:"proof",animate:!0,animationDuration:500,randomize:!1,nodeSeparation:25,fixedNodeConstraint:[{nodeId:e,position:{x:t.$("#"+e).position("x"),y:t.$("#"+e).position("y")}}]}).run(),c.forEach((function(t){var s,a,o,i,n,r,d=cyLayout.getElementById(t.id).boundingBox(),l={x:(d.x2+d.x1)/2,y:(d.y1+d.y2)/2},g=(s=t.pos,a=l,o=t.pos,i={x:a.x-s.x,y:a.y-s.y},{x:o.x+i.x,y:o.y+i.y}),p=(n=t.pos,{x:(r=g).x-n.x,y:r.y-n.y});t.data.forEach((function(t){G(t,p,e)}))})),t.fit(),t.getElementById(e).select()};function y(e){var t={edges:new Set,simpleNodes:[],compoundNodes:[]},s=e.child;s&&s.nodes.forEach((function(e){var s=y(e);for(var a in s)t[a]=[].concat(i(t[a]||[]),i(s[a]));t.edges=new Set(t.edges),e.child?t.compoundNodes.push(e):t.simpleNodes.push(e),e.edges.forEach((function(e){return t.edges.add(e)}))}));return t}function w(e){var t=e.children();t.nonempty()&&t.forEach((function(e){e.select(),w(e)}))}function x(e){return 0!=e.parent().length?x(e.parent()):e}function G(e,t,s){e.isChildless()&&e.id()!=s?e.animate({position:{x:e.position().x+t.x,y:e.position().y+t.y}},{duration:500}):e.children().forEach((function(e){G(e,t,s)}))}return v}var v,b,y=(v=Math.max,b=Date.now||function(){return(new Date).getTime()},function(e,t,s){var a,o,i,r,d,l,g,p,c,h=0,u=!1,I=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=t<0?0:+t||0,!0===s){var f=!0;I=!1}else c=n(p=s),!p||"object"!=c&&"function"!=c||(f=!!s.leading,u="maxWait"in s&&v(+s.maxWait||0,t),I="trailing"in s?!!s.trailing:I);function E(t,s){s&&clearTimeout(s),o=l=g=void 0,t&&(h=b(),i=e.apply(d,a),l||o||(a=d=void 0))}function D(){var e=t-(b()-r);e<=0||e>t?E(g,o):l=setTimeout(D,e)}function m(){E(I,l)}function M(){if(a=arguments,r=b(),d=this,g=I&&(l||!f),!1===u)var s=f&&!l;else{o||f||(h=r);var n=u-(r-h),p=n<=0||n>u;p?(o&&(o=clearTimeout(o)),h=r,i=e.apply(d,a)):o||(o=setTimeout(m,n))}return p&&l?l=clearTimeout(l):l||t===u||(l=setTimeout(D,t)),s&&(p=!0,i=e.apply(d,a)),!p||l||o||(a=d=void 0),i}return M.cancel=function(){l&&clearTimeout(l),o&&clearTimeout(o),h=0,o=l=g=void 0},M}),w=function(e,t,s){var a,o=!0;return function(){var i=this,n=arguments;clearTimeout(a),a=setTimeout((function(){a=null,e.apply(i,n),o=!0}),t),o&&(s.apply(i,n),o=!1)}},x={name:"fcose",animate:!0,randomize:!1};function G(e,t,s){var o,i=e,r=function(){var e=t.scratch("_cyExpandCollapse");return e&&e.cueUtilities},d={init:function(){var e=document.createElement("canvas");e.classList.add("expand-collapse-canvas");var i=document.getElementById("cy"),n=e.getContext("2d");i.appendChild(e);var r=function(e){var t=e.getBoundingClientRect();return{top:t.top+document.documentElement.scrollTop,left:t.left+document.documentElement.scrollLeft}};function d(){var s=i.offsetWidth,a=i.offsetHeight,o=s*c.pixelRatio,n=a*c.pixelRatio;e.width=o,e.height=n,e.style.width="".concat(s,"px"),e.style.height="".concat(a,"px"),t.trigger("cyCanvas.resize")}t.on("resize",(function(){d()})),e.setAttribute("style","position:absolute; top:0; left:0; z-index:".concat(c().zIndex,";"));var g=y((function(){e.height=t.container().offsetHeight,e.width=t.container().offsetWidth,e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=c().zIndex,setTimeout((function(){var s=r(e),a=r(i);e.style.top=-(s.top-a.top),e.style.left=-(s.left-a.left),t&&h()}),0)}),250);d();var p={};function c(){return t.scratch("cyComplexityManagement").options}function h(){var e=t.width(),s=t.height();n.clearRect(0,0,e,s),o=null}function u(e,t,s,a,o){var i=new Image(a,o);i.src=e,i.onload=function(){n.drawImage(i,t,s,a,o)}}t.on("resize",p.eCyResize=function(){g()}),t.on("expandcollapse.clearvisualcue",(function(){o&&h()}));var I=null,f=null;t.on("mousedown",p.eMouseDown=function(e){I=e.renderedPosition||e.cyRenderedPosition}),t.on("mouseup",p.eMouseUp=function(e){f=e.renderedPosition||e.cyRenderedPosition}),t.on("remove","node",p.eRemove=function(e){e.target==o&&h()}),t.on("select unselect",p.eSelect=function(){o&&h();var e=t.nodes(":selected");if(1===e.length){var a=e[0];(s.isExpandable(a)||s.isCollapsible(a))&&function(e){var s,a=e.hasClass("cy-expand-collapse-collapsed-node"),i=c().expandCollapseCueSize,r=c().expandCollapseCueLineSize;if("top-left"===c().expandCollapseCuePosition){var d=t.zoom()<1?i/(2*t.zoom()):i/2,g=parseFloat(e.css("border-width"));s={x:e.position("x")-e.width()/2-parseFloat(e.css("padding-left"))+g+d+1,y:e.position("y")-e.height()/2-parseFloat(e.css("padding-top"))+g+d+1}}else{var p=c().expandCollapseCuePosition;s="function"==typeof p?p.call(this,e):p}var h=l(s),I=((i=Math.max(i,i*t.zoom()))-(r=Math.max(r,r*t.zoom())))/2,f=h.x,E=h.y,D=f-i/2,m=E-i/2,M=i;if(a&&c().expandCueImage)u(c().expandCueImage,D,m,i,i);else if(!a&&c().collapseCueImage)u(c().collapseCueImage,D,m,i,i);else{var v=n.fillStyle,b=n.lineWidth,y=n.strokeStyle;n.fillStyle="black",n.strokeStyle="black",n.ellipse(f,E,i/2,i/2,0,0,2*Math.PI),n.fill(),n.beginPath(),n.strokeStyle="white",n.lineWidth=Math.max(2.6,2.6*t.zoom()),n.moveTo(D+I,m+i/2),n.lineTo(D+r+I,m+i/2),a&&(n.moveTo(D+i/2,m+I),n.lineTo(D+i/2,m+r+I)),n.closePath(),n.stroke(),n.strokeStyle=y,n.fillStyle=v,n.lineWidth=b}e._private.data.expandcollapseRenderedStartX=D,e._private.data.expandcollapseRenderedStartY=m,e._private.data.expandcollapseRenderedCueSize=M,o=e}(a)}}),t.on("tap",p.eTap=function(e){var i=o;if(i){var n=i.data("expandcollapseRenderedStartX"),r=i.data("expandcollapseRenderedStartY"),d=i.data("expandcollapseRenderedCueSize"),l=n+d,g=r+d,p=e.renderedPosition||e.cyRenderedPosition,u=p.x,E=p.y,D=c(),m=(D.expandCollapseCueSensitivity-1)/2;Math.abs(I.x-f.x)<5&&Math.abs(I.y-f.y)<5&&u>=n-d*m&&u<=l+d*m&&E>=r-d*m&&E<=g+d*m&&(x=null!=D.layoutBy?a({},D.layoutBy):null,s.isCollapsible(i)?(h(),s.collapseNodes([i]),null!=x&&t.layout(x).run()):s.isExpandable(i)&&(h(),s.expandNodes([i],!1,!0),setTimeout((function(){null!=x&&t.layout(x).run()}),700)))}}),t.on("afterUndo afterRedo",p.eUndoRedo=p.eSelect),t.on("position","node",p.ePosition=w(p.eSelect,100,h)),t.on("pan zoom",p.ePosition),p.hasEventFields=!0,function(e){var s=t.scratch("_cyExpandCollapse");null==s&&(s={}),s.cueUtilities=e,t.scratch("_cyExpandCollapse",s)}(p)},unbind:function(){var e=r();e.hasEventFields?(t.trigger("expandcollapse.clearvisualcue"),t.off("mousedown","node",e.eMouseDown).off("mouseup","node",e.eMouseUp).off("remove","node",e.eRemove).off("tap","node",e.eTap).off("add","node",e.eAdd).off("position","node",e.ePosition).off("pan zoom",e.ePosition).off("select unselect",e.eSelect).off("free","node",e.eFree).off("resize",e.eCyResize).off("afterUndo afterRedo",e.eUndoRedo)):console.log("events to unbind does not exist")},rebind:function(){var e=r();e.hasEventFields?t.on("mousedown","node",e.eMouseDown).on("mouseup","node",e.eMouseUp).on("remove","node",e.eRemove).on("tap","node",e.eTap).on("add","node",e.eAdd).on("position","node",e.ePosition).on("pan zoom",e.ePosition).on("select unselect",e.eSelect).on("free","node",e.eFree).on("resize",e.eCyResize).on("afterUndo afterRedo",e.eUndoRedo):console.log("events to rebind does not exist")}},l=function(e){var s=t.pan(),a=t.zoom();return{x:e.x*a+s.x,y:e.y*a+s.y}};if(d[i])return d[i].apply(t.container(),Array.prototype.slice.call(arguments,1));if("object"==n(i)||!i)return d.init.apply(t.container(),arguments);throw new Error("No such function `"+i+"` for cytoscape.js-expand-collapse")}function N(e){function t(e,t){void 0===e.scratch("cyComplexityManagement")&&e.scratch("cyComplexityManagement",{});var s=e.scratch("cyComplexityManagement");return void 0===t?s:s[t]}function s(e,s,a){t(e)[s]=a}e("core","complexityManagement",(function(e){var a=this,o={layoutBy:null,filterRule:function(e){return!1},cueEnabled:!0,expandCollapseCuePosition:"top-left",expandCollapseCueSize:12,expandCollapseCueLineSize:8,expandCueImage:void 0,collapseCueImage:void 0,expandCollapseCueSensitivity:1,zIndex:999};if("get"!==e){o=function(e,t){var s={};for(var a in e)s[a]=e[a];for(var a in t)s.hasOwnProperty(a)&&(s[a]=t[a]);return s}(o,e);var i=M(a),n=new Map;s(a,"options",o),s(a,"api",i),s(a,"removedEles",n),G(o,a,i)}return t(a,"api")})),window.cyLayout=e({style:[{selector:"node",style:{label:function(e){return e.data("label")},color:"black","font-size":"20px","compound-sizing-wrt-labels":"include",height:40,width:40,padding:"5px","background-fit":"cover","border-color":"black","border-width":1,"border-opacity":1}},{selector:"edge",style:{label:function(e){return e.data("weight")},"curve-style":"bezier","target-arrow-shape":"triangle","text-rotation":"autorotate",width:"1.5px","text-margin-y":"10px","line-color":"black","target-arrow-color":"black"}}],headless:!0,styleEnabled:!0}),window.cyVisible=e({headless:!0,styleEnabled:!0}),window.cyInvisible=e({headless:!0,styleEnabled:!0})}return void 0!==window.cytoscape&&N(window.cytoscape),N}));
